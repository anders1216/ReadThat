webpackJsonp([6],{141:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),r=n(4),i=(n(7),n(9)),o=n(142),l=n.n(o),c=n(5),s=n.n(c);function u(e,t,n,a){var r=e.id?"PUT":"POST",i=e.id?"/articles/"+e.id:"/articles";fetch(i,{method:r,headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({article:e}),credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){e.current_state_path?(t(),window.location.replace(e.current_state_path)):n(e)}).catch(a)}function h(e,t,n){fetch("/image_uploads",{method:"POST",headers:{"X-CSRF-Token":window.csrfToken},body:function(e){var t=window.csrfToken,n=new FormData;return n.append("authenticity_token",t),n.append("image",e.image[0]),e.wrap_cloudinary&&n.append("wrap_cloudinary","true"),n}(e),credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){if(e.error)throw new Error(e.error);return t(e)}).catch(n)}var d=n(2),p=n.n(d),f=n(10),g=n.n(f),m=function(e){var t=e.onChange,n=e.defaultValue;return Object(a.h)(g.a,{className:"articleform__body",id:"article_body_markdown",placeholder:"Body Markdown",value:n,onInput:t,name:"body_markdown"})};m.propTypes={onChange:p.a.func.isRequired,defaultValue:p.a.string.isRequired};var b=m,v=function(e){var t=e.previewResponse,n=e.version,r=e.articleState;return Object(a.h)("div",{className:"container",style:{marginTop:"10px",minHeight:"508px",overflow:"hidden",boxShadow:"0px 0px 0px #fff",border:"0px"}},function(e,t,n){if("help"===e)return"";var r=n.tags||t.tagList.split(", "),i="";r.length>0&&r[0].length>0&&(i=r.map(function(e){return Object(a.h)("span",null,e.length>0?Object(a.h)("div",{className:"tag"},e):""," ")}));var o="";n.cover_image&&n.cover_image.length>0?o=Object(a.h)("div",{className:"articleform__mainimage articleform__mainimagepreview"},Object(a.h)("img",{src:n.cover_image,alt:"cover image"})):t.mainImage&&(o=Object(a.h)("div",{className:"articleform__mainimage articleform__mainimagepreview"},Object(a.h)("img",{src:t.mainImage,alt:"cover image"})));var l=n.title||t.title||"";return Object(a.h)("div",null,o,Object(a.h)("div",{className:"title",style:{width:"90%",maxWidth:"1000px"}},Object(a.h)("h1",{className:l.length>44?"articleform_titlepreviewsmall":""},l),Object(a.h)("h3",null,Object(a.h)("img",{className:"profile-pic",src:window.currentUser.profile_image_90,alt:"image"}),"\xa0",Object(a.h)("span",null,window.currentUser.name)),Object(a.h)("div",{className:"tags"},i)))}(n,r,t),Object(a.h)("div",{className:"body",dangerouslySetInnerHTML:{__html:t.processed_html},style:{width:"90%"}}))};v.propTypes={previewResponse:p.a.object.isRequired,articleState:p.a.object.isRequired,version:p.a.string.isRequired};var y=v,w=function(e){var t=e.previewShowing,n=e.onPreview,r=e.onSaveDraft,i=e.onPublish,o=e.onHelp,l=e.published,c=e.helpShowing,s=e.edited,u=e.version,h=e.onClearChanges;return Object(a.h)("div",{className:"articleform__buttons"},Object(a.h)("button",{onClick:o,type:"button",className:c?"articleform__buttons--small active":"articleform__buttons--small inactive"},"?"),Object(a.h)("button",{onClick:n,type:"button",className:t?"active":"inactive"},"PREVIEW"),l||"v1"===u?"":Object(a.h)("button",{onClick:r,type:"button"},"SAVE DRAFT"),Object(a.h)("span",null,Object(a.h)("p",{style:!s&&{visibility:"hidden"}},"New Changes (",Object(a.h)("button",{onClick:h,className:"clear-button",type:"button"},"clear"),")"),Object(a.h)("button",{onClick:i,className:"articleform__buttons--publish",type:"button"},l||"v1"===u?"SAVE CHANGES":"PUBLISH")))};w.propTypes={previewShowing:p.a.bool.isRequired,onPreview:p.a.func.isRequired,onSaveDraft:p.a.func.isRequired,onPublish:p.a.func.isRequired,onHelp:p.a.func.isRequired,published:p.a.bool.isRequired,helpShowing:p.a.bool.isRequired,edited:p.a.bool.isRequired,version:p.a.string.isRequired,onClearChanges:p.a.func.isRequired};var O=w,j=function(e){var t=e.published,n=e.version;return Object(a.h)("div",{className:"articleform__notice articleform__notice--"+(t?"publishing":"draft")},t&&"v2"===n?"Publishing...":"Saving "+("v2"===n?"Draft":"")+"...")};j.propTypes={published:p.a.bool.isRequired,version:p.a.string.isRequired};var _=j,S=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var C={UP:38,DOWN:40,LEFT:37,RIGHT:39,TAB:9,RETURN:13,COMMA:188,DELETE:8},k=4,T=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));Object.defineProperty(n,"handleTagClick",{enumerable:!0,writable:!0,value:function(e){document.getElementById("tag-input").focus(),n.insertTag(e.target.dataset.content)}}),Object.defineProperty(n,"handleInput",{enumerable:!0,writable:!0,value:function(e){var t=e.target.value;"insertText"===e.inputType&&(","===e.target.value[e.target.selectionStart-2]&&(t=n.insertSpace(t,e.target.selectionStart-1)));","===e.data&&(t+=" "),n.props.onInput(t);var a=n.getCurrentTagAtSelectionIndex(e.target.value,e.target.selectionStart-1);return n.setState({selectedIndex:0,cursorIdx:e.target.selectionStart,prevLen:n.textArea.value.length}),n.search(a)}}),Object.defineProperty(n,"handleKeyDown",{enumerable:!0,writable:!0,value:function(e){var t=n;t.selected.length!==k||e.keyCode!==C.COMMA?e.keyCode!==C.DOWN&&e.keyCode!==C.TAB||n.isBottomOfSearchResults||""==t.props.defaultValue?e.keyCode!==C.UP||n.isTopOfSearchResults?e.keyCode===C.RETURN&&n.isSearchResultSelected?(e.preventDefault(),n.insertTag(t.state.searchResults[t.state.selectedIndex].name),setTimeout(function(){document.getElementById("tag-input").focus()},10)):e.keyCode!==C.COMMA||n.isSearchResultSelected?e.keyCode===C.DELETE?","===t.props.defaultValue[t.props.defaultValue.length-1]&&n.clearSelectedSearchResult():(e.keyCode<65||e.keyCode>90)&&e.keyCode!=C.COMMA&&e.keyCode!=C.DELETE&&e.keyCode!=C.LEFT&&e.keyCode!=C.RIGHT&&e.keyCode!=C.TAB&&e.preventDefault():(n.resetSearchResults(),n.clearSelectedSearchResult()):(e.preventDefault(),n.moveUpInSearchResults()):(e.preventDefault(),n.moveDownInSearchResults()):e.preventDefault()}}),Object.defineProperty(n,"handleFocusChange",{enumerable:!0,writable:!0,value:function(e){var t=n;setTimeout(function(){"tag-input"!==document.activeElement.id&&t.forceUpdate()},100)}}),n.state={selectedIndex:-1,searchResults:[],cursorIdx:0,prevLen:0};var a=document.querySelector("meta[name='algolia-public-id']").content,r=document.querySelector("meta[name='algolia-public-key']").content,i=document.querySelector("meta[name='environment']").content,o=algoliasearch(a,r);return n.index=o.initIndex("Tag_"+i),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["Component"]),S(t,[{key:"componentDidUpdate",value:function(){this.state.cursorIdx<this.textArea.value.length&&this.textArea.value.length<this.state.prevLen+1&&(this.textArea.selectionStart=this.textArea.selectionEnd=this.state.cursorIdx)}},{key:"render",value:function(){var e=this,t="",n=this.state.searchResults.map(function(t,n){return Object(a.h)("div",{tabIndex:"-1",className:"articleform__tagoptionrow articleform__tagoptionrow--"+(e.state.selectedIndex===n?"active":"inactive"),onClick:e.handleTagClick,"data-content":t.name},t.name)});return this.state.searchResults.length>0&&"tag-input"===document.activeElement.id&&(t=Object(a.h)("div",{className:"articleform__tagsoptions"},n)),Object(a.h)("div",{className:"articleform__tagswrapper"},Object(a.h)("textarea",{id:"tag-input",type:"text",ref:function(t){return e.textArea=t},className:"articleform__tags",placeholder:"tags",value:this.props.defaultValue,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onBlur:this.handleFocusChange,onFocus:this.handleFocusChange}),t)}},{key:"insertSpace",value:function(e,t){return e.slice(0,t)+" "+e.slice(t,e.length)}},{key:"getCurrentTagAtSelectionIndex",value:function(e,t){var n=0,a={};e.split("").map(function(e,t){","===e?n++:a[t]=n});var r=e.split(",")[a[t]];return void 0===r?"":r.trim()}},{key:"search",value:function(e){var t=this;return""===e?new Promise(function(e){setTimeout(function(){t.resetSearchResults(),e()},5)}):this.index.search(e,{hitsPerPage:10,attributesToHighlight:[],filters:"supported:true"}).then(function(e){t.setState({searchResults:e.hits.filter(function(e){return!t.selected.includes(e.name)})})})}},{key:"resetSearchResults",value:function(){this.setState({searchResults:[]})}},{key:"moveUpInSearchResults",value:function(){this.setState({selectedIndex:this.state.selectedIndex-1})}},{key:"moveDownInSearchResults",value:function(){this.setState({selectedIndex:this.state.selectedIndex+1})}},{key:"clearSelectedSearchResult",value:function(){this.setState({selectedIndex:-1})}},{key:"insertTag",value:function(e){var t=document.getElementById("tag-input"),n=this.getRangeBetweenCommas(t.value,t.selectionStart),a=n[1]===t.value.length,r=this.selected.length===k;a&&!r&&(e+=", ");var i=t.value.slice(0,n[0])+e+t.value.slice(n[1],t.value.length);this.props.onInput(i),this.resetSearchResults(),this.clearSelectedSearchResult()}},{key:"getRangeBetweenCommas",value:function(e,t){var n=0,a=e.length,r=e.slice(0,t).split("").reverse().indexOf(","),i=e.slice(t).indexOf(",");return-1!==r&&(n=t-r+1),-1!==i&&(a=t+i),[n,a]}},{key:"selected",get:function(){return this.props.defaultValue.split(",").map(function(e){return void 0!==e&&e.trim()}).filter(function(e){return e.length>0})}},{key:"isTopOfSearchResults",get:function(){return this.state.selectedIndex<=0}},{key:"isBottomOfSearchResults",get:function(){return this.state.selectedIndex>=this.state.searchResults.length-1}},{key:"isSearchResultSelected",get:function(){return this.state.selectedIndex>-1}}]),t}();T.propTypes={defaultValue:p.a.string.isRequired};var I=T,R=function(e){var t=e.onChange,n=e.defaultValue,r=e.onKeyDown;return Object(a.h)(g.a,{className:"articleform__title",type:"text",id:"article-form-title",placeholder:"Title",autoComplete:"off",value:n,onInput:t,onKeyDown:r})};R.propTypes={onChange:p.a.func.isRequired,defaultValue:p.a.string.isRequired,onKeyDown:p.a.func.isRequired};var P=R,E=function(e){var t=e.mainImage,n=e.onEdit;return Object(a.h)("div",{className:"articleform__mainimage",onClick:n},Object(a.h)("img",{src:t}))};E.propTypes={mainImage:p.a.string.isRequired};var x=E,M=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var N=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(n,"handleMainImageUpload",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.clearUploadError(),h({image:e.target.files,wrap_cloudinary:!0},n.props.onMainImageUrlChange,n.onUploadError)}}),Object.defineProperty(n,"handleInsertionImageUpload",{enumerable:!0,writable:!0,value:function(e){n.clearUploadError(),h({image:e.target.files},n.handleInsertImageUploadSuccess,n.onUploadError)}}),Object.defineProperty(n,"handleInsertImageUploadSuccess",{enumerable:!0,writable:!0,value:function(e){n.setState({insertionImageUrl:e.link})}}),Object.defineProperty(n,"triggerMainImageRemoval",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),(0,n.props.onMainImageUrlChange)({link:null})}}),Object.defineProperty(n,"clearUploadError",{enumerable:!0,writable:!0,value:function(){n.setState({uploadError:!1,uploadErrorMessage:null})}}),Object.defineProperty(n,"onUploadError",{enumerable:!0,writable:!0,value:function(e){n.setState({insertionImageUrl:null,uploadError:!0,uploadErrorMessage:e.message})}}),n.state={insertionImageUrl:null,uploadError:!1,uploadErrorMessage:null},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["Component"]),M(t,[{key:"render",value:function(){var e=this.props,t=e.onExit,n=e.mainImage,r=e.version,i=this.state,o=i.insertionImageUrl,l=i.uploadError,c=i.uploadErrorMessage,s=void 0;s=n?Object(a.h)("div",null,Object(a.h)("img",{src:n,alt:"main"}),Object(a.h)("button",{type:"button",onClick:this.triggerMainImageRemoval},"Remove Cover Image")):Object(a.h)("div",null,Object(a.h)("input",{type:"file",onChange:this.handleMainImageUpload}));var u=void 0;u=o?Object(a.h)("div",null,Object(a.h)("h3",null,"Markdown Image:"),Object(a.h)("input",{type:"text",value:"![]("+o+")"}),Object(a.h)("h3",null,"Direct URL:"),Object(a.h)("input",{type:"text",value:o})):Object(a.h)("div",null,Object(a.h)("input",{type:"file",onChange:this.handleInsertionImageUpload}));var h=void 0;return h="v1"===r?Object(a.h)("div",null,Object(a.h)("h2",null,"Upload an Image"),u,Object(a.h)("div",null,Object(a.h)("p",null,Object(a.h)("em",null,"To add a cover image for the post, add ",Object(a.h)("code",null,"cover_image: direct_url_to_image.jpg")," to the frontmatter")))):Object(a.h)("div",null,Object(a.h)("h2",null,"Cover Image"),s,Object(a.h)("h2",null,"Body Images"),u),Object(a.h)("div",{className:"articleform__overlay"},Object(a.h)("button",{type:"button",className:"articleform__exitbutton","data-content":"exit",onClick:t},"\xd7"),l&&Object(a.h)("span",{className:"articleform__uploaderror"},c),h,Object(a.h)("div",null,Object(a.h)("button",{type:"button",className:"articleform__donebutton",onClick:t},"Done")))}}]),t}(),D=N;N.propTypes={onExit:p.a.func.isRequired,onMainImageUrlChange:p.a.func.isRequired,mainImage:p.a.string.isRequired,version:p.a.string.isRequired};var U=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var A=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(n,"handleSeriesButtonClick",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.props.onConfigChange(e)}}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["Component"]),U(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.onExit,r=t.passedData,i=t.onSaveDraft,o="",l=Object(a.h)("small",null,"Will this post be part of a series? Give the series a unique name. (Series visible once it has multiple posts)");if(r.allSeries.length>0){var c=r.allSeries.map(function(t){return Object(a.h)("button",{name:"series",onClick:e.props.onConfigChange,value:t},t)});l=Object(a.h)("small",null,"Existing series:",c)}return r.published&&(o=Object(a.h)("div",null,Object(a.h)("h4",null,"Danger Zone"),Object(a.h)("button",{onClick:i},"Unpublish Post"))),Object(a.h)("div",{className:"articleform__overlay"},Object(a.h)("h3",null,"Additional Config/Settings"),Object(a.h)("button",{className:"articleform__exitbutton","data-content":"exit",onClick:n},"\xd7"),Object(a.h)("div",null,Object(a.h)("label",null,"Canonical URL"),Object(a.h)("input",{type:"text",value:r.canonicalUrl,name:"canonicalUrl",onKeyUp:this.props.onConfigChange})),Object(a.h)("small",null,"Change meta tag",Object(a.h)("code",null,"canonical_url")," ","if this post was first published elsewhere (like your own blog)"),Object(a.h)("div",null,Object(a.h)("label",null,"Series Name"),Object(a.h)("input",{type:"text",value:r.series,name:"series",onKeyUp:this.props.onConfigChange})),l,Object(a.h)("div",null,Object(a.h)("button",{className:"articleform__donebutton",onClick:n},"Done")),o)}}]),t}(),L=A;A.propTypes={onExit:p.a.func.isRequired};var q=function(e){var t=e.organization,n=e.postUnderOrg,r=e.onToggle;return Object(a.h)("div",{className:"articleform__orgsettings",onClick:r},Object(a.h)("img",{src:t.profile_image_90,style:{opacity:n?"1":"0.7"}})," ",t.name," ",Object(a.h)("button",{className:n?"yes":"no"},n?"\u2705 YES":"\u25fb\ufe0f NO"))};q.propTypes={onChange:p.a.func.isRequired,defaultValue:p.a.string.isRequired};var B=q,H=function(e){var t=e.errorsList;return Object(a.h)("div",{className:"articleform__errors"},Object(a.h)("h2",null,"\ud83d\ude31 Heads up:"),Object(a.h)("ul",null,Object.keys(t).map(function(e){return Object(a.h)("li",null,e,":",t[e])})))};H.propTypes={onChange:p.a.func.isRequired,defaultValue:p.a.string.isRequired};var V=H,F=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var K=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));Object.defineProperty(n,"checkContentChanges",{enumerable:!0,writable:!0,value:function(e){return n.state.bodyMarkdown!==e.bodyMarkdown||n.state.title!==e.title||n.state.mainImage!==e.mainImage||n.state.tagList!==e.tagList}}),Object.defineProperty(n,"localStoreContent",{enumerable:!0,writable:!0,value:function(){var e=n.state,t=e.version,a=e.title,r=e.tagList,i=e.mainImage,o=e.bodyMarkdown;localStorage.setItem("editor-"+t+"-"+n.url,JSON.stringify({title:a,tagList:r,mainImage:i,bodyMarkdown:o}))}}),Object.defineProperty(n,"toggleHelp",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),window.scrollTo(0,0),n.setState({helpShowing:!n.state.helpShowing,previewShowing:!1})}}),Object.defineProperty(n,"fetchPreview",{enumerable:!0,writable:!0,value:function(e){var t,a,r;e.preventDefault(),n.state.previewShowing?n.setState({previewShowing:!1,helpShowing:!1}):(t=n.state.bodyMarkdown,a=n.showPreview,r=n.failedPreview,fetch("/articles/preview",{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({article_body:t}),credentials:"same-origin"}).then(function(e){return e.json()}).then(a).catch(r))}}),Object.defineProperty(n,"toggleImageManagement",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.setState({imageManagementShowing:!n.state.imageManagementShowing})}}),Object.defineProperty(n,"toggleMoreConfig",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.setState({moreConfigShowing:!n.state.moreConfigShowing})}}),Object.defineProperty(n,"showPreview",{enumerable:!0,writable:!0,value:function(e){e.processed_html?n.setState({previewShowing:!0,helpShowing:!1,previewResponse:e,errors:null}):n.setState({errors:e,submitting:!1})}}),Object.defineProperty(n,"toggleOrgPosting",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.setState({postUnderOrg:!n.state.postUnderOrg})}}),Object.defineProperty(n,"failedPreview",{enumerable:!0,writable:!0,value:function(e){console.log(e)}}),Object.defineProperty(n,"handleConfigChange",{enumerable:!0,writable:!0,value:function(e){e.preventDefault();var t={};t[e.target.name]=e.target.value,n.setState(t)}}),Object.defineProperty(n,"handleMainImageUrlChange",{enumerable:!0,writable:!0,value:function(e){n.setState({mainImage:e.link,imageManagementShowing:!1})}}),Object.defineProperty(n,"removeLocalStorage",{enumerable:!0,writable:!0,value:function(){var e=n.state.version;localStorage.removeItem("editor-"+e+"-"+n.url),window.removeEventListener("beforeunload",n.localStoreContent)}}),Object.defineProperty(n,"onPublish",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.setState({submitting:!0,published:!0});var t=n.state;t.published=!0,u(t,n.removeLocalStorage,n.handleArticleError)}}),Object.defineProperty(n,"onSaveDraft",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),n.setState({submitting:!0,published:!1});var t=n.state;t.published=!1,u(t,n.removeLocalStorage,n.handleArticleError)}}),Object.defineProperty(n,"handleTitleKeyDown",{enumerable:!0,writable:!0,value:function(e){13===e.keyCode&&e.preventDefault()}}),Object.defineProperty(n,"handleBodyKeyDown",{enumerable:!0,writable:!0,value:function(e){}}),Object.defineProperty(n,"onClearChanges",{enumerable:!0,writable:!0,value:function(e){e.preventDefault(),(confirm("Are you sure you want to revert to the previous save?")||"DEV-Native-ios"===navigator.userAgent)&&n.setState({title:n.article.title||"",tagList:n.article.cached_tag_list||"",description:"",canonicalUrl:n.article.canonical_url||"",series:n.article.series||"",allSeries:n.article.all_series||[],bodyMarkdown:n.article.body_markdown||"",published:n.article.published||!1,previewShowing:!1,helpShowing:!1,previewResponse:"",helpHTML:document.getElementById("editor-help-guide").innerHTML,submitting:!1,editing:null!=n.article.id,imageManagementShowing:!1,moreConfigShowing:!1,mainImage:n.article.main_image||null,errors:null,edited:!1})}}),Object.defineProperty(n,"handleArticleError",{enumerable:!0,writable:!0,value:function(e){window.scrollTo(0,0),n.setState({errors:e,submitting:!1})}}),Object.defineProperty(n,"toggleEdit",{enumerable:!0,writable:!0,value:function(){n.localStoreContent(),n.state.edited||n.setState({edited:!0})}}),n.article=JSON.parse(n.props.article);var a=n.props.organization?JSON.parse(n.props.organization):null;return n.url=window.location.href,n.state={id:n.article.id||null,title:n.article.title||"",tagList:n.article.cached_tag_list||"",description:"",canonicalUrl:n.article.canonical_url||"",series:n.article.series||"",allSeries:n.article.all_series||[],bodyMarkdown:n.article.body_markdown||"",published:n.article.published||!1,previewShowing:!1,helpShowing:!1,previewResponse:"",helpHTML:document.getElementById("editor-help-guide").innerHTML,submitting:!1,editing:null!=n.article.id,imageManagementShowing:!1,moreConfigShowing:!1,mainImage:n.article.main_image||null,organization:a,postUnderOrg:!!n.article.organization_id,errors:null,edited:!1,version:n.props.version},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["Component"]),F(t,[{key:"componentDidMount",value:function(){var e=this.state.version,t=JSON.parse(localStorage.getItem("editor-"+e+"-"+window.location.href));t&&this.checkContentChanges(t)&&this.setState({title:t.title||"",tagList:t.tagList||"",mainImage:t.mainImage||null,bodyMarkdown:t.bodyMarkdown||"",edited:!0}),window.addEventListener("beforeunload",this.localStoreContent)}},{key:"render",value:function(){var e=this.state,t=e.title,n=e.tagList,r=e.bodyMarkdown,o=e.published,c=e.previewShowing,u=e.helpShowing,h=e.previewResponse,d=e.helpHTML,p=e.submitting,f=e.imageManagementShowing,g=e.moreConfigShowing,m=e.organization,v=e.postUnderOrg,w=e.mainImage,j=e.errors,S=e.version,C=p?Object(a.h)(_,{published:o,version:S}):"",k=w&&!c&&"v2"===S?Object(a.h)(x,{mainImage:w,onEdit:this.toggleImageManagement}):"",T=f?Object(a.h)(D,{onExit:this.toggleImageManagement,mainImage:w,version:S,onMainImageUrlChange:this.handleMainImageUrlChange}):"",R=g?Object(a.h)(L,{onExit:this.toggleMoreConfig,passedData:this.state,onSaveDraft:this.onSaveDraft,onConfigChange:this.handleConfigChange}):"",E=m?Object(a.h)(B,{organization:m,postUnderOrg:v,onToggle:this.toggleOrgPosting}):"",M=j?Object(a.h)(V,{errorsList:j}):"",N="";if(c)N=Object(a.h)("div",null,M,E,k,Object(a.h)(y,{previewResponse:h,articleState:this.state,version:"article-preview"}));else if(u)N=Object(a.h)(y,{previewResponse:{processed_html:d},version:"help"});else{var U="",A="";"v2"===S&&(A=Object(a.h)("button",{type:"button",className:"articleform__detailsButton articleform__detailsButton--moreconfig articleform__detailsButton--bottom",onClick:this.toggleMoreConfig},Object(a.h)("img",{src:s.a,alt:"menu dots"})),U=Object(a.h)("div",{className:t.length>128?"articleform__titleTooLong":""},Object(a.h)(P,{defaultValue:t,onKeyDown:this.handleTitleKeyDown,onChange:Object(i.a)(this,"title")}),Object(a.h)("div",{className:"articleform__detailfields"},Object(a.h)(I,{defaultValue:n,onInput:Object(i.a)(this,"tagList")}),Object(a.h)("button",{className:"articleform__detailsButton articleform__detailsButton--image",onClick:this.toggleImageManagement},Object(a.h)("img",{src:l.a})),Object(a.h)("button",{className:"articleform__detailsButton articleform__detailsButton--moreconfig",onClick:this.toggleMoreConfig},Object(a.h)("img",{src:s.a}))))),N=Object(a.h)("div",null,M,E,k,U,Object(a.h)(b,{defaultValue:r,onKeyDown:this.handleBodyKeyDown,onChange:Object(i.a)(this,"bodyMarkdown")}),Object(a.h)("button",{className:"articleform__detailsButton articleform__detailsButton--image articleform__detailsButton--bottom",onClick:this.toggleImageManagement},Object(a.h)("img",{src:l.a,alt:"upload images"})," ","IMAGES"),A)}return Object(a.h)("form",{className:"articleform__form articleform__form--"+S,onSubmit:this.onSubmit,onInput:this.toggleEdit},N,Object(a.h)(O,{published:o,version:S,previewShowing:c,helpShowing:u,onPreview:this.fetchPreview,onPublish:this.onPublish,onHelp:this.toggleHelp,onSaveDraft:this.onSaveDraft,onClearChanges:this.onClearChanges,edited:this.state.edited,onChange:Object(i.a)(this,"published")}),C,T,R)}}]),t}();function J(){Object(r.c)().then(function(e){var t=e.currentUser,n=e.csrfToken;window.currentUser=t,window.csrfToken=n;var r=document.getElementById("article-form"),i=r.dataset,o=i.article,l=i.organization,c=i.version;Object(a.render)(Object(a.h)(K,{article:o,organization:l,version:c}),r,r.firstElementChild)})}HTMLDocument.prototype.ready=new Promise(function(e){return"loading"!==document.readyState?e():(document.addEventListener("DOMContentLoaded",function(){return e()}),null)}),document.ready.then(function(){J(),window.InstantClick.on("change",function(){document.getElementById("article-form")&&J()})})},142:function(e,t,n){e.exports=n.p+"_/assets/images/image-upload-5eb4cd5a742522be043418dc028917b5.svg"},3:function(e,t,n){"use strict";t.b=function(e,t,n){fetch("/chat_channels/"+e,{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.j=function(e,t,n,a){fetch("/messages",{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({message:{message_markdown:t,user_id:window.currentUser.id,chat_channel_id:e}}),credentials:"same-origin"}).then(function(e){return e.json()}).then(n).catch(a)},t.k=function(e,t,n){fetch("/chat_channels/"+e+"/open",{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({}),credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.a=function(e,t,n,a){fetch("/chat_channels/"+e+"/moderate",{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({chat_channel:{command:t}}),credentials:"same-origin"}).then(function(e){return e.json()}).then(n).catch(a)},t.d=function(e,t,n,r,i,o,l){var c=algoliasearch(n.algoliaId,n.algoliaKey).initIndex(n.algoliaIndex),s=a({hitsPerPage:30+r,page:r},i);c.search(e,s).then(function(n){var a=n.hits;null===t||1===n.hits.filter(function(e){return e.chat_channel_id===t}).length?o(a,e):fetch("/chat_channel_memberships/find_by_chat_channel_id?chat_channel_id="+t,{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(function(t){a.unshift(t),o(a,e)})})},t.i=function(e,t,n){fetch("/push_notification_subscriptions",{method:"POST",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({subscription:e}),credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.g=function(e,t,n){fetch("/twilio_tokens/"+e,{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.e=function(e,t,n){fetch(e,{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.f=function(e,t,n){fetch(e,{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(t).catch(n)},t.c=function(e,t){fetch("/chat_channels?state=pending",{Accept:"application/json","Content-Type":"application/json",credentials:"same-origin"}).then(function(e){return e.json()}).then(e).catch(t)},t.h=function(e,t,n,a){fetch("/chat_channel_memberships/"+e,{method:"PUT",headers:{Accept:"application/json","X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({chat_channel_membership:{user_action:t}}),credentials:"same-origin"}).then(function(e){return e.json()}).then(n).catch(a)};var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}},4:function(e,t,n){"use strict";t.c=function(){return new Promise(function(e,t){o({resolve:e,reject:t})()})},t.e=function(){var e=document.getElementById("messagelist");e.scrollTop=e.scrollHeight},t.g=function(e){var t=document.querySelector("#messagelist__sentinel");new IntersectionObserver(e,{threshold:[0,1]}).observe(t)},t.d=function(e,t){return Object.keys(e).reduce(function(n,a){var r=e[a].map(function(e){if(e.user_id===t){var n=Object.assign({type:"hidden"},e);return n.message="<message removed>",n.messageColor="lightgray",n}return e});return i({},n,function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},a,r))},{})},t.a=function(e){var t=new Date(e);return t=new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(t)},t.f=l,t.b=function(){if(!window.location.href.includes("ask-for-notifications"))return"dont-ask";if(!("Notification"in window))return"not-supported";var e=Notification.permission;"granted"===e&&l();return"default"===e?"waiting-permission":e};var a=n(6),r=(n.n(a),n(3)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};var o=function(e){var t=e.resolve,n=e.reject,a=e.waitTime,r=void 0===a?20:a,i=0;return function e(){if(3e3!==i){var a,o=(document,null!==(a=document.querySelector("meta[name='csrf-token']"))?a.content:void 0),l=document.body.dataset.user;if(l&&void 0!==o){var c=JSON.parse(l);t({currentUser:c,csrfToken:o})}else i+=r,setTimeout(e,r)}else n(new Error("Couldn't find user data on page."))}};function l(){navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:window.vapidPublicKey})}).then(function(e){Object(r.i)(e.toJSON(),null,null)})})}},5:function(e,t,n){e.exports=n.p+"_/assets/images/three-dots-764ab825bf011bdd1a2d150bb072d6ef.svg"}},[141]);
//# sourceMappingURL=articleForm-41e76b1174380d92437b.js.map